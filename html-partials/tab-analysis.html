<!-- Analysis Tab (Trade Pattern Mining) -->
<div id="analysisTab" style="display: none;">
    <div class="empty-state empty-state-illustrated" id="emptyAnalysis">
        <div class="empty-state-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z" />
            </svg>
        </div>
        <h3 class="empty-state-title">Trade Pattern Analysis</h3>
        <p class="empty-state-description">
            Run a backtest first, then analyze winning vs losing trade patterns to discover data-driven filters.
        </p>
    </div>

    <div id="analysisContent" style="display: none;">
        <div class="analysis-header">
            <div class="analysis-header-left">
                <h3 class="analysis-title">Feature Discrimination</h3>
                <span class="analysis-subtitle" id="analysisSummary"></span>
            </div>
            <div class="analysis-header-right">
                <label class="analysis-control analysis-control-toggle" for="analysisRelaxModeToggle">
                    <input type="checkbox" id="analysisRelaxModeToggle">
                    <span>Relax-Aware</span>
                </label>
                <label class="analysis-control" for="analysisMaxRemovalPercent">
                    <span>Max Removed %</span>
                    <input type="number" id="analysisMaxRemovalPercent" min="5" max="90" step="1" value="20">
                </label>
                <button class="btn btn-primary btn-compact" id="runAnalysisBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path
                            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6z" />
                    </svg>
                    Analyze
                </button>
            </div>
        </div>

        <div class="analysis-table-wrap">
            <table class="analysis-table" id="analysisTable">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Win Mean</th>
                        <th>Loss Mean</th>
                        <th>Score</th>
                        <th>Filter</th>
                        <th>Proj. WR</th>
                        <th>Proj. Exp</th>
                        <th>Removed</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="analysisTableBody">
                </tbody>
            </table>
        </div>

        <!-- Finder (Random + Local refinement) -->
        <div class="analysis-finder-section">
            <div class="analysis-finder-header">
                <h4 class="analysis-finder-title">Filter Finder</h4>
                <div class="analysis-finder-controls">
                    <label class="analysis-control" for="analysisFinderMinScore">
                        <span>Min Score %</span>
                        <input type="number" id="analysisFinderMinScore" min="0" max="100" step="1" value="10">
                    </label>
                    <label class="analysis-control" for="analysisFinderRandomTrials">
                        <span>Random Trials</span>
                        <input type="number" id="analysisFinderRandomTrials" min="1" max="50000" step="1" value="300">
                    </label>
                    <label class="analysis-control" for="analysisFinderRefineTrials">
                        <span>Refine Trials</span>
                        <input type="number" id="analysisFinderRefineTrials" min="0" max="50000" step="1" value="120">
                    </label>
                    <label class="analysis-control" for="analysisFinderRangePercent">
                        <span>Range %</span>
                        <input type="number" id="analysisFinderRangePercent" min="1" max="100" step="1" value="100">
                    </label>
                    <label class="analysis-control" for="analysisFinderMinBadRemoved">
                        <span>Min Bad Removed %</span>
                        <input type="number" id="analysisFinderMinBadRemoved" min="0" max="100" step="1" value="20">
                    </label>
                    <label class="analysis-control" for="analysisFinderMaxGoodRemoved">
                        <span>Max Good Removed %</span>
                        <input type="number" id="analysisFinderMaxGoodRemoved" min="0" max="100" step="1" value="8">
                    </label>
                    <label class="analysis-control" for="analysisFinderMaxTotalRemoved">
                        <span>Max Total Removed %</span>
                        <input type="number" id="analysisFinderMaxTotalRemoved" min="0" max="100" step="1" value="25">
                    </label>
                    <button class="btn btn-primary btn-compact" id="analysisRunFinderBtn" type="button">Run Finder</button>
                </div>
            </div>
            <div class="analysis-finder-status" id="analysisFinderStatus"></div>
            <div class="analysis-finder-results" id="analysisFinderResults" style="display: none;">
                <div class="simulation-grid" id="analysisFinderBestGrid"></div>
                <div class="analysis-finder-table-wrap">
                    <table class="analysis-finder-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Objective</th>
                                <th>Filters</th>
                                <th>Bad Removed</th>
                                <th>Good Removed</th>
                                <th>Total Removed</th>
                                <th>Exp Delta</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="analysisFinderTopBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Combo (Multi-Feature) Filter -->
        <div class="analysis-simulation combo-filter-section" id="comboFilterSection" style="display: none;">
            <h4 class="simulation-title">ðŸŽ¯ Best Combined Filter <span class="sim-approx-badge">approx.</span></h4>
            <div class="simulation-grid" id="comboFilterGrid"></div>
        </div>

        <!-- Single-Feature Filter Simulation (shown on "Test" click) -->
        <div class="analysis-simulation" id="analysisSimulation" style="display: none;">
            <h4 class="simulation-title">Filter Simulation <span class="sim-approx-badge">approx.</span></h4>
            <div class="simulation-grid" id="simulationGrid"></div>
            <div class="sim-disclaimer">Estimates based on post-hoc filtering. Actual backtest results may differ due to
                position sizing and capital changes.</div>
        </div>
    </div>
</div>
