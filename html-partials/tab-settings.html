<!-- Settings Tab -->
<div id="settingsTab" data-preset="standard">
    <div class="section-header config-header">
        <div class="section-title">Strategy Configurations</div>
    </div>

    <div class="config-actions">
        <div class="config-input-row">
            <input type="text" class="param-input config-name-input" id="configNameInput"
                placeholder="Configuration name..." />
            <button class="btn btn-success btn-icon" id="saveConfigBtn"
                title="Save current settings as configuration">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                    <path
                        d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6V6z" />
                </svg>
            </button>
        </div>

        <div class="config-list-wrapper">
            <select class="param-input config-select" id="configSelect">
                <option value="">-- Select configuration --</option>
            </select>
            <button class="btn btn-primary btn-icon" id="loadConfigBtn" title="Load selected configuration">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                </svg>
            </button>
            <button class="btn btn-danger btn-icon" id="deleteConfigBtn" title="Delete selected configuration">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                </svg>
            </button>
        </div>
    </div>

    <select class="strategy-select" id="strategySelect">
        <option value="sma_crossover">SMA Crossover</option>
        <option value="ema_crossover">EMA Crossover</option>
        <option value="rsi_oversold">RSI Overbought/Oversold</option>
        <option value="macd_crossover">MACD Crossover</option>
        <option value="bollinger_bounce">Bollinger Band Bounce</option>
        <option value="triple_ma">Triple MA Strategy</option>
    </select>

    <div id="strategyParams">
        <!-- Parameters will be injected here -->
    </div>

    <!-- ── Preset Selector ── -->
    <div class="settings-preset-bar" id="settingsPresetBar">
        <button class="settings-preset-btn" data-preset="simple" type="button">
            <span class="preset-dot"></span>Simple
        </button>
        <button class="settings-preset-btn active" data-preset="standard" type="button">
            <span class="preset-dot"></span>Standard
        </button>
        <button class="settings-preset-btn" data-preset="advanced" type="button">
            <span class="preset-dot"></span>Advanced
        </button>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Trade Direction  (simple)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="simple" data-section="direction">
        <div class="section-header collapsible" data-target="directionBody">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Trade Direction</div>
                <span class="section-changed-dot" id="directionChangedDot"></span>
            </div>
        </div>
        <div class="section-body accordion-body" id="directionBody">
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">Direction Mode</label>
                    <select class="param-input" id="tradeDirection">
                        <option value="long">Long</option>
                        <option value="short" selected>Short</option>
                        <option value="both">Both (Flip)</option>
                        <option value="combined">Combined (L+S)</option>
                    </select>
                    <div class="param-hint">Both flips on opposite signals. Combined runs long+short books in parallel
                        and ignores same-bar opposite entries.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Risk Management  (simple)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="simple" data-section="risk">
        <div class="section-header collapsible" data-target="riskSettings">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Risk Management</div>
                <span class="section-changed-dot" id="riskChangedDot"></span>
            </div>
            <label class="section-toggle" aria-label="Toggle risk management">
                <input type="checkbox" id="riskSettingsToggle">
                <span class="section-toggle-track"></span>
            </label>
        </div>
        <div class="section-body accordion-body" id="riskSettings">
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">Mode</label>
                    <select class="param-input" id="riskMode">
                        <option value="simple" selected>Simple</option>
                        <option value="advanced">Advanced</option>
                        <option value="percentage">Percentage</option>
                    </select>
                    <div class="param-hint">Simple shows core stops. Advanced adds scale-out, break-even, and time stop.
                        Percentage uses fixed % from entry.
                    </div>
                </div>
                <div class="param-group">
                    <label class="param-label">Market Mode</label>
                    <select class="param-input" id="marketMode">
                        <option value="all" selected>All Markets</option>
                        <option value="uptrend">Uptrend</option>
                        <option value="downtrend">Downtrend</option>
                        <option value="sideway">Sideway / Range</option>
                    </select>
                    <div class="param-hint">Trade filter by market regime before opening positions.</div>
                </div>
            </div>
            <div class="risk-simple-advanced" id="riskSimpleAdvanced">
                <div class="param-row">
                    <div class="param-group">
                        <label class="param-label">Volatility Period (ATR)</label>
                        <input type="number" class="param-input" id="atrPeriod" value="14" min="1">
                        <div class="param-hint">ATR measures average movement. Higher = smoother stops.</div>
                    </div>
                    <div class="param-group">
                        <label class="param-label">Stop Loss (ATR x)</label>
                        <input type="number" class="param-input" id="stopLossAtr" value="1.5" min="0" step="0.1">
                    </div>
                </div>
                <div class="param-row">
                    <div class="param-group">
                        <label class="param-label">Take Profit (ATR x)</label>
                        <input type="number" class="param-input" id="takeProfitAtr" value="3" min="0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label class="param-label">Trailing Stop (ATR x)</label>
                        <input type="number" class="param-input" id="trailingAtr" value="2" min="0" step="0.1">
                    </div>
                </div>
                <div class="risk-advanced is-hidden" id="riskAdvanced">
                    <div class="param-row">
                        <div class="param-group">
                            <label class="param-label">Scale Out at R</label>
                            <input type="number" class="param-input" id="partialTakeProfitAtR" value="1" min="0"
                                step="0.1">
                            <div class="param-hint">R = distance from entry to stop loss.</div>
                        </div>
                        <div class="param-group">
                            <label class="param-label">Scale Out Size (%)</label>
                            <input type="number" class="param-input" id="partialTakeProfitPercent" value="50" min="0"
                                max="100">
                        </div>
                    </div>
                    <div class="param-row">
                        <div class="param-group">
                            <label class="param-label">Move Stop to Break-even at R</label>
                            <input type="number" class="param-input" id="breakEvenAtR" value="1" min="0" step="0.1">
                        </div>
                        <div class="param-group">
                            <label class="param-label">Exit After N Bars (if losing)</label>
                            <input type="number" class="param-input" id="timeStopBars" value="0" min="0">
                        </div>
                    </div>
                </div>
            </div>
            <div class="risk-percentage is-hidden" id="riskPercentage">
                <div class="param-row">
                    <div class="param-group">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <label class="param-label" style="margin-bottom: 0;">Stop Loss (%)</label>
                            <label class="section-toggle" style="transform: scale(0.8);" aria-label="Toggle stop loss">
                                <input type="checkbox" id="stopLossToggle">
                                <span class="section-toggle-track"></span>
                            </label>
                        </div>
                        <input type="number" class="param-input" id="stopLossPercent" value="5" min="0.1" max="15"
                            step="0.1">
                        <div class="param-hint">Allowed: 0 - 15%</div>
                    </div>
                    <div class="param-group">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <label class="param-label" style="margin-bottom: 0;">Take Profit (%)</label>
                            <label class="section-toggle" style="transform: scale(0.8);"
                                aria-label="Toggle take profit">
                                <input type="checkbox" id="takeProfitToggle">
                                <span class="section-toggle-track"></span>
                            </label>
                        </div>
                        <input type="number" class="param-input" id="takeProfitPercent" value="10" min="0.1" max="100"
                            step="0.1">
                        <div class="param-hint">Allowed: 0 - 100%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Fixed Trade Amount  (simple)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="simple" data-section="sizing">
        <div class="section-header collapsible" data-target="tradeSizingBody">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Fixed Trade Amount Mode</div>
                <span class="section-changed-dot" id="sizingChangedDot"></span>
            </div>
            <label class="section-toggle" aria-label="Toggle fixed trade amount mode">
                <input type="checkbox" id="fixedTradeToggle" checked>
                <span class="section-toggle-track"></span>
            </label>
        </div>
        <div class="section-body accordion-body" id="tradeSizingBody">
            <div class="param-row">
                <div class="param-group" id="initialCapitalGroup">
                    <label class="param-label">Initial Capital ($)</label>
                    <input type="number" class="param-input" id="initialCapital" value="10000" min="100">
                </div>
                <div class="param-group" id="fixedTradeGroup">
                    <label class="param-label">Fixed Trade Amount ($)</label>
                    <input type="number" class="param-input" id="fixedTradeAmount" value="1000" min="1">
                </div>
            </div>

            <div class="param-row">
                <div class="param-group" id="positionSizeGroup">
                    <label class="param-label">Position Size (%)</label>
                    <input type="number" class="param-input" id="positionSize" value="100" min="1" max="100">
                </div>
                <div class="param-group">
                    <label class="param-label">Commission (%)</label>
                    <input type="number" class="param-input" id="commission" value="0.1" min="0" step="0.01">
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Backend Engine  (standard)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="standard" data-section="engine">
        <div class="section-header collapsible" data-target="engineBody">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Backend Engine</div>
            </div>
            <label class="section-toggle" aria-label="Toggle Rust backend">
                <input type="checkbox" id="useRustEngineToggle" checked>
                <span class="section-toggle-track"></span>
            </label>
        </div>
        <div class="section-body accordion-body" id="engineBody">
            <div class="param-hint">Prefer Rust for faster backtests when available. Turn off to force TypeScript.</div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Backtest Realism  (standard)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="standard" data-section="realism">
        <div class="section-header collapsible collapsed" data-target="realismBody">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Backtest Realism</div>
                <span class="section-changed-dot" id="realismChangedDot"></span>
            </div>
        </div>
        <div class="section-body accordion-body collapsed" id="realismBody">
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">Execution Model</label>
                    <select class="param-input" id="executionModel">
                        <option value="next_open" selected>Next Bar Open (realistic)</option>
                        <option value="next_close">Next Bar Close (conservative)</option>
                        <option value="signal_close">Signal Bar Close (optimistic)</option>
                    </select>
                    <div class="param-hint">Next-bar execution reduces look-ahead bias.</div>
                </div>
                <div class="param-group">
                    <label class="param-label">Slippage (bps)</label>
                    <input type="number" class="param-input" id="slippageBps" value="5" min="0" max="100" step="1">
                    <div class="param-hint">Applied on entry and exit fills.</div>
                </div>
            </div>
            <div class="param-row">
                <div class="param-group">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Allow Same-Bar Exits</label>
                        <label class="section-toggle" style="transform: scale(0.8);" aria-label="Toggle same-bar exits">
                            <input type="checkbox" id="allowSameBarExitToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div class="param-hint">Disable to avoid entry/exit on the same bar.</div>
                </div>
            </div>
            <div class="param-row">
                <div class="param-group">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Use Strategy Timeframe</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle global strategy timeframe">
                            <input type="checkbox" id="strategyTimeframeToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div class="param-hint">Run signal logic on higher timeframe, map entries back to current chart
                        bars.
                    </div>
                </div>
                <div class="param-group" id="strategyTimeframeMinutesGroup">
                    <label class="param-label">Strategy TF (minutes)</label>
                    <input type="number" class="param-input" id="strategyTimeframeMinutes" value="120" min="1" step="1">
                    <div class="param-hint">Example: chart 5m + strategy 120m.</div>
                </div>
            </div>
            <div class="param-hint">Realism settings use the TypeScript engine (Rust skipped for accuracy).</div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Trade Filter  (standard)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="standard" data-section="tradeFilter">
        <div class="section-header collapsible collapsed" data-target="tradeFilterSettings">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Trade Filter</div>
                <span class="section-changed-dot" id="filterChangedDot"></span>
            </div>
            <label class="section-toggle" aria-label="Toggle trade filter">
                <input type="checkbox" id="tradeFilterSettingsToggle">
                <span class="section-toggle-track"></span>
            </label>
        </div>
        <div class="section-body accordion-body collapsed" id="tradeFilterSettings">
            <div class="param-group">
                <label class="param-label">Filter Mode</label>
                <select class="param-input" id="tradeFilterMode">
                    <option value="none" selected>None</option>
                    <option value="close">Close Breakout</option>
                    <option value="volume">Volume Expansion</option>
                    <option value="rsi">RSI Confirmation</option>
                    <option value="trend">Trend Alignment (EMA)</option>
                    <option value="adx">ADX Strength</option>
                </select>
                <div class="param-hint">Simple trade-quality filter applied before opening positions.</div>
            </div>
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">Filter Lookback (bars)</label>
                    <input type="number" class="param-input" id="confirmLookback" value="1" min="1">
                </div>
                <div class="param-group">
                    <label class="param-label">Volume SMA Period</label>
                    <input type="number" class="param-input" id="volumeSmaPeriod" value="20" min="1">
                </div>
            </div>
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">Volume Multiplier</label>
                    <input type="number" class="param-input" id="volumeMultiplier" value="1.5" min="0" step="0.1">
                </div>
                <div class="param-group">
                    <label class="param-label">RSI Period</label>
                    <input type="number" class="param-input" id="confirmRsiPeriod" value="14" min="1">
                </div>
            </div>
            <div class="param-row">
                <div class="param-group">
                    <label class="param-label">RSI Bullish</label>
                    <input type="number" class="param-input" id="confirmRsiBullish" value="55" min="0" max="100">
                </div>
                <div class="param-group">
                    <label class="param-label">RSI Bearish</label>
                    <input type="number" class="param-input" id="confirmRsiBearish" value="45" min="0" max="100">
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Entry Quality Filters  (advanced)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="advanced" data-section="entryQuality">
        <div class="section-header collapsible collapsed" data-target="entryQualityBody">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Entry Quality Filters</div>
            </div>
        </div>
        <div class="section-body accordion-body collapsed" id="entryQualityBody">
            <div class="param-hint">Data-driven filters from trade analysis. Multiple filters stack (AND logic). Uses
                TypeScript engine.</div>

            <!-- ATR% Filter -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">ATR % Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);" aria-label="Toggle ATR% filter">
                            <input type="checkbox" id="snapshotAtrFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAtrPercentMin" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Min ATR%</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAtrPercentMax" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Max ATR%</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Volume Ratio Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Volume Ratio filter">
                            <input type="checkbox" id="snapshotVolumeFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeRatioMin" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Min ratio</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeRatioMax" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Max ratio</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">ADX Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);" aria-label="Toggle ADX filter">
                            <input type="checkbox" id="snapshotAdxFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAdxMin" value="0" min="0" step="1">
                            <div class="param-hint">Min ADX</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAdxMax" value="0" min="0" step="1">
                            <div class="param-hint">Max ADX</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">EMA Distance % Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle EMA Distance filter">
                            <input type="checkbox" id="snapshotEmaFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotEmaDistanceMin" value="0" step="0.5">
                            <div class="param-hint">Min %</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotEmaDistanceMax" value="0" step="0.5">
                            <div class="param-hint">Max %</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RSI Filter -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">RSI Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);" aria-label="Toggle RSI filter">
                            <input type="checkbox" id="snapshotRsiFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotRsiMin" value="0" min="0" max="100"
                                step="1">
                            <div class="param-hint">Min RSI</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotRsiMax" value="0" min="0" max="100"
                                step="1">
                            <div class="param-hint">Max RSI</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Price Range Pos</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Price Range Pos filter">
                            <input type="checkbox" id="snapshotPriceRangePosFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotPriceRangePosMin" value="0" min="0"
                                max="1" step="0.05">
                            <div class="param-hint">Min (0-1)</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotPriceRangePosMax" value="0" min="0"
                                max="1" step="0.05">
                            <div class="param-hint">Max (0-1)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bars from High/Low Filter -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Max Bars from High</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Bars from High filter">
                            <input type="checkbox" id="snapshotBarsFromHighFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <input type="number" class="param-input" id="snapshotBarsFromHighMax" value="0" min="0" step="1">
                    <div class="param-hint">Only enter within N bars of recent 20-bar high.</div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Max Bars from Low</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Bars from Low filter">
                            <input type="checkbox" id="snapshotBarsFromLowFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <input type="number" class="param-input" id="snapshotBarsFromLowMax" value="0" min="0" step="1">
                    <div class="param-hint">Only enter within N bars of recent 20-bar low.</div>
                </div>
            </div>

            <!-- Advanced Snapshot Filters -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Trend Efficiency</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Trend Efficiency filter">
                            <input type="checkbox" id="snapshotTrendEfficiencyFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotTrendEfficiencyMin" value="0" min="0"
                                max="1" step="0.05">
                            <div class="param-hint">Min (0-1)</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotTrendEfficiencyMax" value="0" min="0"
                                max="1" step="0.05">
                            <div class="param-hint">Max (0-1)</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">ATR Regime Ratio</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle ATR Regime Ratio filter">
                            <input type="checkbox" id="snapshotAtrRegimeFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAtrRegimeRatioMin" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Min ratio</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotAtrRegimeRatioMax" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Max ratio</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Body % of Range</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Body Percent filter">
                            <input type="checkbox" id="snapshotBodyPercentFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotBodyPercentMin" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Min %</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotBodyPercentMax" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Max %</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Wick Skew %</label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Wick Skew filter">
                            <input type="checkbox" id="snapshotWickSkewFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotWickSkewMin" value="0" min="-100"
                                max="100" step="1">
                            <div class="param-hint">Min (-100 to 100)</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotWickSkewMax" value="0" min="-100"
                                max="100" step="1">
                            <div class="param-hint">Max (-100 to 100)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Close Location %
                            <span class="tooltip-icon"
                                data-tooltip="Directional close quality in candle range. Higher = stronger close in trade direction.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Close Location filter">
                            <input type="checkbox" id="snapshotCloseLocationFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotCloseLocationMin" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Min %</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotCloseLocationMax" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Max %</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Opposite Wick %
                            <span class="tooltip-icon"
                                data-tooltip="Wick against entry direction as % of range. Lower is cleaner.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Opposite Wick filter">
                            <input type="checkbox" id="snapshotOppositeWickFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotOppositeWickMin" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Min %</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotOppositeWickMax" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Max %</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Range / ATR
                            <span class="tooltip-icon"
                                data-tooltip="Candle range sanity vs ATR. Filters out dead bars and extreme spikes.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Range ATR filter">
                            <input type="checkbox" id="snapshotRangeAtrFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotRangeAtrMultipleMin" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Min multiple</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotRangeAtrMultipleMax" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Max multiple</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Momentum Consistency %
                            <span class="tooltip-icon"
                                data-tooltip="Directional consistency over recent candles. 66% ~= 2 of last 3 support entry.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Momentum Consistency filter">
                            <input type="checkbox" id="snapshotMomentumFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotMomentumConsistencyMin" value="0"
                                min="0" max="100" step="1">
                            <div class="param-hint">Min %</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotMomentumConsistencyMax" value="0"
                                min="0" max="100" step="1">
                            <div class="param-hint">Max %</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Break Quality
                            <span class="tooltip-icon"
                                data-tooltip="Requires directional close-through quality beyond trigger level.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Break Quality filter">
                            <input type="checkbox" id="snapshotBreakQualityFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotBreakQualityMin" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Min score</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotBreakQualityMax" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Max score</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Entry Quality Score
                            <span class="tooltip-icon"
                                data-tooltip="Composite 0-100 score from candle quality factors.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Entry Quality Score filter">
                            <input type="checkbox" id="snapshotEntryQualityScoreFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotEntryQualityScoreMin" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Min score</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotEntryQualityScoreMax" value="0" min="0"
                                max="100" step="1">
                            <div class="param-hint">Max score</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Volume Trend & Volume Burst Filters -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Volume Trend
                            <span class="tooltip-icon"
                                data-tooltip="Short/long volume EMA ratio. >1 = volume building, <1 = fading.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Volume Trend filter">
                            <input type="checkbox" id="snapshotVolumeTrendFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeTrendMin" value="0" min="0"
                                step="0.05">
                            <div class="param-hint">Min ratio</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeTrendMax" value="0" min="0"
                                step="0.05">
                            <div class="param-hint">Max ratio</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Volume Burst
                            <span class="tooltip-icon"
                                data-tooltip="Z-score of current volume vs recent bars. Higher = more unusual spike.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Volume Burst filter">
                            <input type="checkbox" id="snapshotVolumeBurstFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeBurstMin" value="0" step="0.1">
                            <div class="param-hint">Min z-score</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeBurstMax" value="0" step="0.1">
                            <div class="param-hint">Max z-score</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vol-Price Agreement & Volume Consistency Filters -->
            <div class="param-row snapshot-filter-row">
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Vol-Price Agreement
                            <span class="tooltip-icon"
                                data-tooltip="Price-volume direction agreement (-1 to 1). Negative = divergence, weak move.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Vol-Price Divergence filter">
                            <input type="checkbox" id="snapshotVolumePriceDivergenceFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumePriceDivergenceMin" value="0"
                                min="-1" max="1" step="0.1">
                            <div class="param-hint">Min (-1 to 1)</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumePriceDivergenceMax" value="0"
                                min="-1" max="1" step="0.1">
                            <div class="param-hint">Max (-1 to 1)</div>
                        </div>
                    </div>
                </div>
                <div class="param-group" style="flex: 1;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <label class="param-label" style="margin-bottom: 0;">Volume Consistency
                            <span class="tooltip-icon"
                                data-tooltip="Volume stability (CV). Lower = steady institutional flow, higher = erratic retail noise.">&#9432;</span>
                        </label>
                        <label class="section-toggle" style="transform: scale(0.8);"
                            aria-label="Toggle Volume Consistency filter">
                            <input type="checkbox" id="snapshotVolumeConsistencyFilterToggle">
                            <span class="section-toggle-track"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeConsistencyMin" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Min CV</div>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" class="param-input" id="snapshotVolumeConsistencyMax" value="0" min="0"
                                step="0.1">
                            <div class="param-hint">Max CV</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════
         Section: Confirmation Strategies  (advanced)
         ══════════════════════════════════════════════════════════════════════ -->
    <div class="settings-section" data-complexity="advanced" data-section="confirmation">
        <div class="section-header collapsible collapsed" data-target="confirmationStrategies">
            <div style="display:flex;align-items:center;">
                <span class="section-chevron"><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg></span>
                <div class="section-title">Confirmation Strategies</div>
            </div>
            <label class="section-toggle" aria-label="Toggle confirmation strategies">
                <input type="checkbox" id="confirmationStrategiesToggle">
                <span class="section-toggle-track"></span>
            </label>
        </div>
        <div class="section-body accordion-body collapsed" id="confirmationStrategies">
            <div class="param-hint">Require additional strategy signals to confirm entries (filters persist until
                flipped).
                Up to 5.</div>
            <div class="confirmation-strategy-list" id="confirmationStrategyList"></div>
            <div class="confirmation-actions">
                <button class="btn btn-secondary btn-compact" id="confirmationAddBtn" type="button">Add
                    Strategy</button>
            </div>
        </div>
    </div>



    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Processing...</div>
    </div>

    <!-- Settings Actions -->
    <div class="settings-actions">
        <div class="settings-actions-row">
            <button class="btn btn-secondary btn-compact" id="resetSettingsBtn"
                title="Reset all settings to default values">
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                    <path
                        d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" />
                </svg>
                Reset to Default
            </button>
        </div>
    </div>

    <button class="open-editor-btn" id="openCodeEditor">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
        </svg>
        Create Custom Strategy
    </button>
</div>
